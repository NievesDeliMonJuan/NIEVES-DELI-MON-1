<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recuerdos | Compartir</title>
  <style>
    body {
      margin: 1rem;
      font-family: monospace;
      text-align: center;
    }

    #cabecera {
      background: blue;
      color: #fff;
      padding: 0.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }

    .contenedor {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0.5rem 0;
    }

    input {
      width: 80%;
      max-width: 200px;
      margin: 0.25rem 0;
      padding: 0.25rem;
      text-align: center;
      font-size: 1rem;
    }

    button {
      margin: 0.5rem 0.25rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: #07f;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button#imprimir {
      display: none;
    }

    #tableOut {
      display: none;
      margin-top: 1rem;
    }

    table {
      margin: auto;
      border-collapse: collapse;
      font-family: monospace;
    }

    th, td {
      border: 1px solid #000;
      padding: 0.25rem 0.5rem;
    }
  </style>
</head>
<body>

  <div id="cabecera">NIEVES DOÃ‘A BETI</div>

  <script>
    const tipos = ["litro","medio","25","15","10","cono"];
    tipos.forEach(nombre => {
      const cont = document.createElement("div");
      cont.className = "contenedor";
      ["Llenar","Regreso"].forEach(pref => {
        const inp = document.createElement("input");
        inp.placeholder = `${pref} ${nombre}`;
        inp.inputMode = "numeric";
        cont.appendChild(inp);
      });
      document.body.appendChild(cont);
    });
  </script>

  <button id="calcular">Calcular</button>
  <button id="imprimir">Imprimir</button>

  <div id="tableOut"></div>

  <script>
    const precios = { litro: 60, medio: 35, 25: 25, 15: 15, 10: 10, cono: 15 };
    const abrevs  = { litro: "lt", medio: "md", 25: "25", 15: "15", 10: "10", cono: "co" };

    // para texto plano
    function pad(s, w, align = "r") {
      s = String(s);
      if (s.length >= w) return s;
      const sp = " ".repeat(w - s.length);
      return align === "r" ? sp + s : s + sp;
    }

    function recopilarDatos() {
      const inputs = [...document.querySelectorAll("input")];
      const Ls = inputs.filter(i => i.placeholder.startsWith("Llenar"));
      const Rs = inputs.filter(i => i.placeholder.startsWith("Regreso"));
      const filas = [];
      let suma = 0;

      Ls.forEach((li, i) => {
        const tipo = li.placeholder.split(" ")[1];
        const ab   = abrevs[tipo];
        const vL   = parseInt(li.value) || 0;
        const vR   = parseInt(Rs[i].value) || 0;
        const dif  = vL - vR;
        const pago = dif * precios[tipo];
        suma += pago;
        filas.push({ ab, vL, vR, dif, pago });
      });

      return { filas, suma };
    }

    function generarTablaHTML() {
      const { filas, suma } = recopilarDatos();
      let html = "<table><thead><tr>"
               + "<th>N</th><th>L</th><th>R</th><th>D</th><th>P</th>"
               + "</tr></thead><tbody>";
      filas.forEach(r => {
        html += `<tr>
                   <td>${r.ab}</td>
                   <td>${r.vL}</td>
                   <td>${r.vR}</td>
                   <td>${r.dif}</td>
                   <td>${r.pago}</td>
                 </tr>`;
      });
      html += `<tr>
                 <td colspan="4">SP</td>
                 <td>${suma}</td>
               </tr>`;
      html += "</tbody></table>";
      return html;
    }

    function generarTablaTexto() {
      const { filas, suma } = recopilarDatos();
      const wN = 2, wC = 3, wP = 4, wS = 5;
      let txt  = "| "+pad("N",wN,"l")+"|"+pad("L",wC)+"|"+pad("R",wC)
               +"|"+pad("D",wC)+"|"+pad("P",wP)+"|\n";
      filas.forEach(r => {
        txt += "| "+pad(r.ab,wN,"l")+"|"+pad(r.vL,wC)
             +"|"+pad(r.vR,wC)+"|"+pad(r.dif,wC)
             +"|"+pad(r.pago,wP)+"|\n";
      });
      txt += "| "+pad("SP",wN,"l")+"|"+pad("",wC)
           +"|"+pad("",wC)+"|"+pad("",wC)
           +"|"+pad(suma,wS)+"|";
      return txt;
    }

    document.getElementById("calcular").onclick = () => {
      const cont = document.getElementById("tableOut");
      cont.innerHTML = generarTablaHTML();
      cont.style.display = "block";
      document.getElementById("imprimir").style.display = "inline-block";
    };

    document.getElementById("imprimir").onclick = async () => {
      const txt   = generarTablaTexto();
      const blob  = new Blob([txt], { type: "text/plain" });
      const file  = new File([blob], "tabla.txt", { type: "text/plain" });

      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        try {
          await navigator.share({ title: "Tabla", files: [file] });
        } catch {
          // fallback: mostrar texto
          alert("No se pudo compartir directamente, se muestra en pantalla.");
          console.log(txt);
        }
      } else {
        alert("Compartir no soportado, revisa la consola.");
        console.log(txt);
      }
    };
  </script>

</body>
</html>
